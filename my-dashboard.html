<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>My Dashboard</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f3f4f6;
        }
        .overflow-y-auto::-webkit-scrollbar {
            width: 8px;
        }
        .overflow-y-auto::-webkit-scrollbar-track {
            background: #e5e7eb;
        }
        .overflow-y-auto::-webkit-scrollbar-thumb {
            background-color: #9ca3af;
            border-radius: 4px;
            border: 2px solid #e5e7eb;
        }
        .overflow-y-auto::-webkit-scrollbar-thumb:hover {
            background-color: #6b7280;
        }
        .task-row:hover .task-actions {
            opacity: 1;
        }
        /* Custom line-clamp implementation for broader compatibility */
        .line-clamp-2 {
            display: -webkit-box;
            -webkit-box-orient: vertical;
            -webkit-line-clamp: 2;
            overflow: hidden;
            text-overflow: ellipsis;
        }
    </style>
</head>
<body class="flex min-h-screen">
    <!-- Left Navigation -->
    <aside class="bg-white shadow-lg w-64 p-6 flex flex-col justify-between">
        <div>
            <h1 class="text-3xl font-bold text-gray-800 mb-8">My Dashboard</h1>
            <nav class="space-y-2">
                <button id="my-tasks-tab" class="w-full text-left px-4 py-2 font-medium text-sm rounded-lg transition-colors duration-200 bg-indigo-600 text-white shadow-md hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2">
                    My Tasks
                </button>
                <button id="compliance-tab" class="w-full text-left px-4 py-2 font-medium text-sm rounded-lg transition-colors duration-200 text-gray-700 hover:bg-gray-100 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2">
                    Compliance
                </button>
            </nav>
        </div>
    </aside>

    <!-- Main Content Area -->
    <div class="flex-1 p-6 md:p-8 overflow-y-auto">
        <main class="max-w-4xl mx-auto">
            <!-- My Tasks Section -->
            <div id="my-tasks-view" class="active">
                <div class="flex flex-col md:flex-row items-center justify-between mb-6 space-y-4 md:space-y-0">
                    <div class="flex flex-grow items-center space-x-2">
                        <input id="search-input" type="text" placeholder="Search tasks..." class="w-full px-4 py-2 text-sm text-gray-700 border border-gray-300 rounded-full focus:outline-none focus:ring-2 focus:ring-indigo-500 transition-all duration-200">
                        <button id="add-task-btn" class="flex-shrink-0 px-4 py-2 text-sm font-medium rounded-full bg-indigo-600 text-white shadow hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2">
                            Add New Task
                        </button>
                    </div>
                </div>

                <div class="flex flex-wrap items-center justify-start gap-4 mb-6">
                    <div class="flex items-center space-x-2 w-full overflow-x-auto p-1">
                        <span class="text-sm font-medium text-gray-600 flex-shrink-0">Filter:</span>
                        <button data-filter="all" class="filter-btn px-3 py-1.5 text-xs font-medium rounded-full transition-colors duration-200 bg-indigo-600 text-white shadow flex-shrink-0">All</button>
                        <button data-filter="state-cme" class="filter-btn px-3 py-1.5 text-xs font-medium rounded-full transition-colors duration-200 text-gray-700 bg-gray-100 hover:bg-gray-200 flex-shrink-0">State CME</button>
                        <button data-filter="dea" class="filter-btn px-3 py-1.5 text-xs font-medium rounded-full transition-colors duration-200 text-gray-700 bg-gray-100 hover:bg-gray-200 flex-shrink-0">DEA</button>
                        <button data-filter="csr" class="filter-btn px-3 py-1.5 text-xs font-medium rounded-full transition-colors duration-200 text-gray-700 bg-gray-100 hover:bg-gray-200 flex-shrink-0">CSR</button>
                        <button data-filter="course" class="filter-btn px-3 py-1.5 text-xs font-medium rounded-full transition-colors duration-200 text-gray-700 bg-gray-100 hover:bg-gray-200 flex-shrink-0">Courses</button>
                        <button data-filter="administrative" class="filter-btn px-3 py-1.5 text-xs font-medium rounded-full transition-colors duration-200 text-gray-700 bg-gray-100 hover:bg-gray-200 flex-shrink-0">Administrative</button>
                    </div>
                    <!-- Sort dropdown -->
                    <div class="relative w-full md:w-1/4">
                        <select id="sort-select" class="block w-full px-4 py-2 text-sm text-gray-700 bg-white border border-gray-300 rounded-full focus:outline-none focus:ring-2 focus:ring-indigo-500 appearance-none pr-8">
                            <option value="priority-desc">Sort by Priority (High to Low)</option>
                            <option value="due-date-asc">Sort by Due Date</option>
                            <option value="status-asc">Sort by Status</option>
                        </select>
                        <div class="pointer-events-none absolute inset-y-0 right-0 flex items-center px-2 text-gray-700">
                            <svg class="h-4 w-4 fill-current" viewBox="0 0 20 20"><path d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z" clip-rule="evenodd" fill-rule="evenodd"></path></svg>
                        </div>
                    </div>
                </div>

                <!-- Task List as a Table -->
                <div class="overflow-hidden border border-gray-200 rounded-lg shadow-sm max-h-[60vh] overflow-y-auto">
                    <table class="min-w-full divide-y divide-gray-200">
                        <thead class="bg-gray-50 sticky top-0">
                            <tr>
                                <th class="px-4 py-2 text-left text-xs font-semibold text-gray-500 uppercase tracking-wider"></th>
                                <th class="px-4 py-2 text-left text-xs font-semibold text-gray-500 uppercase tracking-wider w-2/5">Task</th>
                                <th class="px-4 py-2 text-left text-xs font-semibold text-gray-500 uppercase tracking-wider">Type</th>
                                <th class="px-4 py-2 text-left text-xs font-semibold text-gray-500 uppercase tracking-wider">Status</th>
                                <th class="px-4 py-2 text-left text-xs font-semibold text-gray-500 uppercase tracking-wider">Priority</th>
                                <th class="px-4 py-2 text-left text-xs font-semibold text-gray-500 uppercase tracking-wider">Due Date</th>
                                <th class="px-4 py-2 text-left text-xs font-semibold text-gray-500 uppercase tracking-wider"></th>
                            </tr>
                        </thead>
                        <tbody id="task-list" class="bg-white divide-y divide-gray-200">
                            <!-- Task items will be rendered here by JavaScript -->
                        </tbody>
                    </table>
                    <div id="no-tasks-message" class="hidden text-center text-gray-500 p-8">
                        No tasks match your search or filter.
                    </div>
                </div>
            </div>

            <!-- Compliance Section -->
            <div id="compliance-view" class="hidden">
                <div class="bg-gray-50 rounded-xl p-4 mb-6">
                    <div class="flex items-center justify-between">
                        <h2 class="text-xl font-semibold text-gray-800">Compliance Overview</h2>
                        <button class="text-gray-500 hover:text-gray-700">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
                                <path d="M13.586 3.586a2 2 0 112.828 2.828l-.793.793-2.828-2.828.793-.793zM11.379 5.793L3 14.172V17h2.828l8.38-8.38-2.828-2.829z" />
                            </svg>
                        </button>
                    </div>
                    <p class="mt-2 text-sm text-gray-500 space-y-1">
                        <div><span class="font-bold text-gray-700">State Medical Licenses:</span> TX, OK, AR</div>
                        <div class="flex items-center space-x-1"><span class="font-bold text-gray-700">DEA:</span> <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 text-green-500" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"></path></svg></div>
                        <div class="flex items-center space-x-1"><span class="font-bold text-gray-700">CSD/CSR:</span> <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 text-green-500" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"></path></svg></div>
                        <div><span class="font-bold text-gray-700">Subspecialty certifications:</span> MQSA</div>
                    </p>
                </div>

                <!-- Admin Note in Compliance section -->
                <div class="bg-yellow-50 text-yellow-800 border-l-4 border-yellow-400 p-4 rounded-lg mb-6 flex items-start">
                    <div class="flex-shrink-0">
                        <svg class="h-5 w-5 text-yellow-400" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15h-2v-2h2v2zm0-4h-2V7h2v6z"/></svg>
                    </div>
                    <div class="ml-3 text-sm">
                        <p class="font-medium">Note from your administrator</p>
                        <p class="mt-1">Rachel: Please make sure to email your paperwork to Rachel. DO IT NOW!</p>
                    </div>
                </div>

                <div class="flex items-center space-x-2 border-b border-gray-200 mb-6 overflow-x-auto">
                    <button data-tab="state-licenses" class="compliance-tab px-4 py-2 font-medium text-sm text-gray-700 border-b-2 border-indigo-600 flex-shrink-0">State Licenses</button>
                    <button data-tab="controlled-substances" class="compliance-tab px-4 py-2 font-medium text-sm text-gray-700 hover:border-b-2 hover:border-gray-300 flex-shrink-0">Controlled Substances</button>
                    <button data-tab="dea" class="compliance-tab px-4 py-2 font-medium text-sm text-gray-700 hover:border-b-2 hover:border-gray-300 flex-shrink-0">DEA</button>
                    <button data-tab="subspecialty" class="compliance-tab px-4 py-2 font-medium text-sm text-gray-700 hover:border-b-2 hover:border-gray-300 flex-shrink-0">Subspecialty certifications</button>
                </div>

                <!-- Compliance Content -->
                <div id="state-licenses-content" class="compliance-content">
                    <h3 class="text-lg font-semibold text-gray-700 mb-2">Texas State Medical License</h3>
                    <p class="text-sm text-gray-600">Requirements: 48 CME credits every 2 years. <span class="font-bold text-red-500">Due: 2025-09-01</span></p>
                    <div class="mt-4 bg-gray-100 p-4 rounded-lg">
                        <p class="font-medium text-sm">Progress towards requirement:</p>
                        <div class="w-full bg-gray-200 rounded-full h-2.5 mt-2">
                            <div class="bg-indigo-600 h-2.5 rounded-full w-3/4"></div>
                        </div>
                        <p class="text-sm text-gray-500 mt-1">36 of 48 credits completed (tracked automatically)</p>
                    </div>
                </div>
                <div id="controlled-substances-content" class="compliance-content hidden">
                    <h3 class="text-lg font-semibold text-gray-700 mb-2">Controlled Substances Requirements</h3>
                    <p class="text-sm text-gray-600">No active controlled substance licenses found.</p>
                </div>
                <div id="dea-content" class="compliance-content hidden">
                    <h3 class="text-lg font-semibold text-gray-700 mb-2">DEA Registration</h3>
                    <p class="text-sm text-gray-600">Requirements: 8 hours of controlled substance training. <span class="font-bold text-red-500">Due: 12/31/2025</span></p>
                    <div class="mt-4 bg-gray-100 p-4 rounded-lg">
                        <p class="font-medium text-sm">Progress towards requirement:</p>
                        <div class="w-full bg-gray-200 rounded-full h-2.5 mt-2">
                            <div class="bg-indigo-600 h-2.5 rounded-full" style="width: 50%;"></div>
                        </div>
                        <p class="text-sm text-gray-500 mt-1">4 of 8 hours completed</p>
                    </div>
                    <div class="mt-6">
                        <h4 class="text-md font-semibold text-gray-800 mb-2">Required Courses</h4>
                        <table class="min-w-full divide-y divide-gray-200 rounded-lg overflow-hidden">
                            <thead class="bg-gray-50">
                                <tr>
                                    <th class="px-4 py-2 text-left text-xs font-semibold text-gray-500 uppercase tracking-wider">Course Title</th>
                                    <th class="px-4 py-2 text-left text-xs font-semibold text-gray-500 uppercase tracking-wider">CME Hours</th>
                                    <th class="px-4 py-2 text-left text-xs font-semibold text-gray-500 uppercase tracking-wider">Status</th>
                                </tr>
                            </thead>
                            <tbody class="bg-white divide-y divide-gray-200">
                                <tr>
                                    <td class="p-4 whitespace-nowrap text-sm text-gray-900">Bottled Abyss - A Deep Dive into Alcohol Use Disorder among Vulnerable Groups</td>
                                    <td class="p-4 whitespace-nowrap text-sm text-gray-500">3</td>
                                    <td class="p-4 whitespace-nowrap text-sm text-gray-500">
                                        <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-green-100 text-green-700">Completed</span>
                                    </td>
                                </tr>
                                <tr>
                                    <td class="p-4 whitespace-nowrap text-sm text-gray-900">Chronic Pain - Therapies, Treatment, and Management Options</td>
                                    <td class="p-4 whitespace-nowrap text-sm text-gray-500">3.25</td>
                                    <td class="p-4 whitespace-nowrap text-sm text-gray-500">
                                        <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-yellow-100 text-yellow-700">In Progress</span>
                                    </td>
                                </tr>
                                <tr>
                                    <td class="p-4 whitespace-nowrap text-sm text-gray-900">Mastering Pain - Mindful Behavioral Techniques for Enhancing Quality of Life in Chronic Pain Patients</td>
                                    <td class="p-4 whitespace-nowrap text-sm text-gray-500">1.5</td>
                                    <td class="p-4 whitespace-nowrap text-sm text-gray-500">
                                        <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-gray-100 text-gray-700">Not Started</span>
                                    </td>
                                </tr>
                                <tr>
                                    <td class="p-4 whitespace-nowrap text-sm text-gray-900">Safe Opiate Prescribing 1HR</td>
                                    <td class="p-4 whitespace-nowrap text-sm text-gray-500">1</td>
                                    <td class="p-4 whitespace-nowrap text-sm text-gray-500">
                                        <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-gray-100 text-gray-700">Not Started</span>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
                <div id="subspecialty-content" class="compliance-content hidden">
                    <h3 class="text-lg font-semibold text-gray-700 mb-2">Subspecialty Certifications</h3>
                    <p class="text-sm text-gray-600">Requirements: 15 CME by 9/1/2025.</p>
                    <div class="mt-4 bg-gray-100 p-4 rounded-lg">
                        <p class="font-medium text-sm">Progress towards requirement:</p>
                        <div class="w-full bg-gray-200 rounded-full h-2.5 mt-2">
                            <div class="bg-indigo-600 h-2.5 rounded-full" style="width: 25%;"></div>
                        </div>
                        <p class="text-sm text-gray-500 mt-1">4 of 15 hours completed</p>
                    </div>
                    <div class="mt-6">
                        <h4 class="text-md font-semibold text-gray-800 mb-2">Required Courses</h4>
                        <table class="min-w-full divide-y divide-gray-200 rounded-lg overflow-hidden">
                            <thead class="bg-gray-50">
                                <tr>
                                    <th class="px-4 py-2 text-left text-xs font-semibold text-gray-500 uppercase tracking-wider">Course Title</th>
                                    <th class="px-4 py-2 text-left text-xs font-semibold text-gray-500 uppercase tracking-wider">CME Hours</th>
                                    <th class="px-4 py-2 text-left text-xs font-semibold text-gray-500 uppercase tracking-wider">Status</th>
                                </tr>
                            </thead>
                            <tbody class="bg-white divide-y divide-gray-200">
                                <tr>
                                    <td class="p-4 whitespace-nowrap text-sm text-gray-900">Breast Tomosynthesis (DBT)</td>
                                    <td class="p-4 whitespace-nowrap text-sm text-gray-500">3.25</td>
                                    <td class="p-4 whitespace-nowrap text-sm text-gray-500">
                                        <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-yellow-100 text-yellow-700">In Progress</span>
                                    </td>
                                </tr>
                                <tr>
                                    <td class="p-4 whitespace-nowrap text-sm text-gray-900">Digital Breast Tomosynthesis Cases</td>
                                    <td class="p-4 whitespace-nowrap text-sm text-gray-500">10.75</td>
                                    <td class="p-4 whitespace-nowrap text-sm text-gray-500">
                                        <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-gray-100 text-gray-700">Not Started</span>
                                    </td>
                                </tr>
                                <tr>
                                    <td class="p-4 whitespace-nowrap text-sm text-gray-900">Diagnostic Breast Imaging (Mammo, Tomo, Ultrasound)</td>
                                    <td class="p-4 whitespace-nowrap text-sm text-gray-500">3.5</td>
                                    <td class="p-4 whitespace-nowrap text-sm text-gray-500">
                                        <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-green-100 text-green-700">Completed</span>
                                    </td>
                                </tr>
                                <tr>
                                    <td class="p-4 whitespace-nowrap text-sm text-gray-900">Digital Breast Tomosynthesis and Tomosynthesis Guided Biopsy Expert Case Review</td>
                                    <td class="p-4 whitespace-nowrap text-sm text-gray-500">0.75</td>
                                    <td class="p-4 whitespace-nowrap text-sm text-gray-500">
                                        <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-gray-100 text-gray-700">Not Started</span>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- Add Task Modal -->
    <div id="add-task-modal" class="fixed inset-0 bg-gray-600 bg-opacity-50 flex items-center justify-center p-4 hidden">
        <div class="bg-white rounded-xl shadow-xl w-full max-w-md p-6">
            <h2 class="text-xl font-bold text-gray-800 mb-4">Add New Task</h2>
            <form id="add-task-form">
                <div class="mb-4">
                    <label for="task-title" class="block text-sm font-medium text-gray-700">Task Title</label>
                    <input type="text" id="task-title" required class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm p-2">
                </div>
                <div class="mb-4">
                    <label for="task-type" class="block text-sm font-medium text-gray-700">Task Type</label>
                    <select id="task-type" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm p-2">
                        <option value="state-cme">State CME</option>
                        <option value="dea">DEA</option>
                        <option value="csr">CSR</option>
                        <option value="course">Course</option>
                        <option value="administrative">Administrative</option>
                        <option value="self-created">Other (Self-created)</option>
                    </select>
                </div>
                <div class="mb-4">
                    <label for="task-priority" class="block text-sm font-medium text-gray-700">Priority</label>
                    <select id="task-priority" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm p-2">
                        <option value="high">High</option>
                        <option value="medium">Medium</option>
                        <option value="low">Low</option>
                    </select>
                </div>
                <div class="mb-4">
                    <label for="task-due-date" class="block text-sm font-medium text-gray-700">Due Date (Optional)</label>
                    <input type="date" id="task-due-date" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm p-2">
                </div>
                <div class="mb-4">
                    <label for="task-link" class="block text-sm font-medium text-gray-700">External URL (Optional)</label>
                    <input type="url" id="task-link" placeholder="https://example.com" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm p-2">
                </div>
                <div class="flex justify-end space-x-2">
                    <button type="button" id="cancel-task-btn" class="px-4 py-2 text-sm font-medium rounded-full bg-gray-200 text-gray-700 hover:bg-gray-300 focus:outline-none focus:ring-2 focus:ring-gray-500">
                        Cancel
                    </button>
                    <button type="submit" class="px-4 py-2 text-sm font-medium rounded-full bg-indigo-600 text-white shadow hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2">
                        Add Task
                    </button>
                </div>
            </form>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // Mock data for tasks. `source: 'admin'` means it's assigned, `source: 'user'` means it's self-created.
            let tasks = [
                { id: 1, title: 'Renew TX state license', type: 'state-cme', status: 'In Progress', dueDate: '2025-09-01', adminNote: 'Please make sure to email your paperwork to Rachel. DO IT NOW!', priority: 'high', source: 'admin' },
                { id: 2, title: 'Complete the 1 time DEA Mate requirement of 8 hours of controlled substance training', type: 'dea', status: 'Not Started', dueDate: '2025-12-31', priority: 'medium', source: 'admin' },
                { id: 3, title: 'Complete the Vascular US course', type: 'course', status: 'Completed', dueDate: '2025-08-15', link: 'https://example.com/course/vascular-us', priority: 'low', source: 'admin' },
                { id: 4, title: 'Finish 12 CME credits', type: 'state-cme', status: 'In Progress', dueDate: '2025-10-30', priority: 'high', source: 'admin' },
                { id: 5, title: 'Review new hospital policies', type: 'administrative', status: 'Not Started', dueDate: '2025-09-15', priority: 'medium', source: 'admin' },
                { id: 6, title: 'Attend the annual cardiology conference', type: 'state-cme', status: 'Not Started', dueDate: '2025-11-20', priority: 'low', source: 'user' },
                { id: 7, title: 'Submit paperwork for Controlled Substances license', type: 'csr', status: 'Not Started', dueDate: '2025-10-01', priority: 'high', source: 'admin' },
                { id: 8, title: 'Complete the Prostrate MRI course', type: 'course', status: 'In Progress', dueDate: null, link: 'https://example.com/course/prostate-mri', priority: 'medium', source: 'admin' },
                { id: 9, title: 'Prepare presentation for quarterly meeting', type: 'administrative', status: 'Not Started', dueDate: '2025-09-25', priority: 'low', source: 'user' },
            ];

            let currentFilter = 'all';
            let currentSort = 'priority-desc';
            let nextTaskId = tasks.length + 1;

            const taskList = document.getElementById('task-list');
            const searchInput = document.getElementById('search-input');
            const myTasksTab = document.getElementById('my-tasks-tab');
            const complianceTab = document.getElementById('compliance-tab');
            const myTasksView = document.getElementById('my-tasks-view');
            const complianceView = document.getElementById('compliance-view');
            const filterBtns = document.querySelectorAll('.filter-btn');
            const complianceTabs = document.querySelectorAll('.compliance-tab');
            const complianceContents = document.querySelectorAll('.compliance-content');
            const noTasksMessage = document.getElementById('no-tasks-message');
            const sortSelect = document.getElementById('sort-select');
            const addTaskBtn = document.getElementById('add-task-btn');
            const addTaskModal = document.getElementById('add-task-modal');
            const addTaskForm = document.getElementById('add-task-form');
            const cancelTaskBtn = document.getElementById('cancel-task-btn');

            const applyFiltersAndSort = () => {
                const searchQuery = searchInput.value.toLowerCase();
                const filteredTasks = tasks.filter(task => {
                    const matchesFilter = currentFilter === 'all' || task.type === currentFilter;
                    const matchesSearch = task.title.toLowerCase().includes(searchQuery);
                    return matchesFilter && matchesSearch;
                });

                if (currentSort === 'priority-desc') {
                    const priorityOrder = { 'high': 3, 'medium': 2, 'low': 1 };
                    filteredTasks.sort((a, b) => priorityOrder[b.priority] - priorityOrder[a.priority]);
                } else if (currentSort === 'due-date-asc') {
                    filteredTasks.sort((a, b) => {
                        if (!a.dueDate) return 1;
                        if (!b.dueDate) return -1;
                        return new Date(a.dueDate) - new Date(b.dueDate);
                    });
                } else if (currentSort === 'status-asc') {
                    const statusOrder = { 'Not Started': 1, 'In Progress': 2, 'Completed': 3 };
                    filteredTasks.sort((a, b) => statusOrder[a.status] - statusOrder[b.status]);
                }

                if (filteredTasks.length === 0) {
                    taskList.innerHTML = '';
                    noTasksMessage.classList.remove('hidden');
                } else {
                    noTasksMessage.classList.add('hidden');
                    taskList.innerHTML = filteredTasks.map(task => {
                        const statusColor = task.status === 'Completed' ? 'bg-green-100 text-green-700' :
                                            task.status === 'In Progress' ? 'bg-yellow-100 text-yellow-700' :
                                            'bg-gray-100 text-gray-700';

                        const priorityColor = task.priority === 'high' ? 'bg-red-500' :
                                              task.priority === 'medium' ? 'bg-orange-500' :
                                              'bg-gray-400';
                        
                        let taskAction = '';
                        if (['state-cme', 'csr', 'dea'].includes(task.type)) {
                            taskAction = `<button onclick="window.goToCompliance('${task.type}')" class="text-xs font-semibold text-indigo-600 hover:text-indigo-800 transition-colors duration-200">Go to requirements &rarr;</button>`;
                        } else if (task.link) {
                            taskAction = `<a href="${task.link}" target="_blank" class="text-xs font-semibold text-indigo-600 hover:text-indigo-800 transition-colors duration-200">Go to course &rarr;</a>`;
                        } else {
                            taskAction = `<button onclick="window.markAsComplete(${task.id})" class="text-xs font-semibold text-indigo-600 hover:text-indigo-800 transition-colors duration-200">Mark as complete</button>`;
                        }

                        const removeButton = task.source === 'user' ? `<button onclick="window.removeTask(${task.id})" class="text-red-500 hover:text-red-700 ml-2 text-sm">
                            <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" d="M9 2a1 1 0 00-.894.553L7.382 4H4a1 1 0 000 2v10a2 2 0 002 2h8a2 2 0 002-2V6a1 1 0 100-2h-3.382l-.724-1.447A1 1 0 0011 2H9zM7 8a1 1 0 012 0v6a1 1 0 11-2 0V8zm6 0a1 1 0 112 0v6a1 1 0 11-2 0V8z" clip-rule="evenodd"></path></svg>
                        </button>` : '';

                        return `
                            <tr class="task-row hover:bg-gray-100">
                                <td class="p-2 whitespace-nowrap">
                                    <input type="checkbox" ${task.status === 'Completed' ? 'checked' : ''} onchange="window.toggleComplete(${task.id}, this.checked)" class="h-4 w-4 rounded text-indigo-600 border-gray-300 focus:ring-indigo-500">
                                </td>
                                <td class="p-2 text-sm text-gray-900 font-medium w-2/5">
                                    <div class="flex items-center space-x-2">
                                        <div class="w-2 h-2 rounded-full ${priorityColor}" title="Priority: ${task.priority.charAt(0).toUpperCase() + task.priority.slice(1)}"></div>
                                        <div class="line-clamp-2" title="${task.title}">
                                            ${task.title}
                                        </div>
                                    </div>
                                </td>
                                <td class="p-2 whitespace-nowrap text-sm text-gray-500">${task.type.split('-').map(word => word.charAt(0).toUpperCase() + word.slice(1)).join(' ')}</td>
                                <td class="p-2 whitespace-nowrap text-sm">
                                    <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full ${statusColor}">${task.status}</span>
                                </td>
                                <td class="p-2 whitespace-nowrap text-sm text-gray-500">${task.priority.charAt(0).toUpperCase() + task.priority.slice(1)}</td>
                                <td class="p-2 whitespace-nowrap text-sm text-gray-500">${task.dueDate || 'N/A'}</td>
                                <td class="p-2 whitespace-nowrap text-right text-sm font-medium">
                                    <div class="flex items-center justify-end space-x-2">
                                        ${taskAction}
                                        ${removeButton}
                                    </div>
                                </td>
                            </tr>
                        `;
                    }).join('');
                }
            };

            window.markAsComplete = (id) => {
                const task = tasks.find(t => t.id === id);
                if (task) {
                    task.status = 'Completed';
                    applyFiltersAndSort();
                }
            };

            window.toggleComplete = (id, isChecked) => {
                const task = tasks.find(t => t.id === id);
                if (task) {
                    task.status = isChecked ? 'Completed' : 'Not Started';
                    applyFiltersAndSort();
                }
            };

            window.removeTask = (id) => {
                tasks = tasks.filter(task => task.id !== id);
                applyFiltersAndSort();
            };

            window.goToCompliance = (type) => {
                // Switch to compliance view
                myTasksTab.classList.remove('bg-indigo-600', 'text-white', 'shadow-md');
                myTasksTab.classList.add('bg-gray-100', 'text-gray-700', 'hover:bg-gray-100');
                complianceTab.classList.add('bg-indigo-600', 'text-white', 'shadow-md');
                complianceTab.classList.remove('bg-gray-100', 'text-gray-700', 'hover:bg-gray-100');
                myTasksView.classList.add('hidden');
                complianceView.classList.remove('hidden');

                // Find and click the correct compliance sub-tab
                let targetTabId;
                if (type === 'state-cme') targetTabId = 'state-licenses';
                if (type === 'csr') targetTabId = 'controlled-substances';
                if (type === 'dea') targetTabId = 'dea';
                if (type === 'fellowship-certificate') targetTabId = 'subspecialty';

                if (targetTabId) {
                    complianceTabs.forEach(t => {
                        t.classList.remove('border-indigo-600');
                        t.classList.add('hover:border-gray-300');
                    });
                    const targetTab = document.querySelector(`[data-tab="${targetTabId}"]`);
                    if (targetTab) {
                        targetTab.classList.add('border-indigo-600');
                        targetTab.classList.remove('hover:border-gray-300');
                    }
                    
                    complianceContents.forEach(c => c.classList.add('hidden'));
                    const targetContent = document.getElementById(`${targetTabId}-content`);
                    if (targetContent) {
                        targetContent.classList.remove('hidden');
                    }
                }
            };

            // Event Listeners
            myTasksTab.addEventListener('click', () => {
                myTasksTab.classList.add('bg-indigo-600', 'text-white', 'shadow-md');
                myTasksTab.classList.remove('bg-gray-100', 'text-gray-700', 'hover:bg-gray-100');
                complianceTab.classList.remove('bg-indigo-600', 'text-white', 'shadow-md');
                complianceTab.classList.add('bg-gray-100', 'text-gray-700', 'hover:bg-gray-100');
                myTasksView.classList.remove('hidden');
                complianceView.classList.add('hidden');
                applyFiltersAndSort();
            });

            complianceTab.addEventListener('click', () => {
                complianceTab.classList.add('bg-indigo-600', 'text-white', 'shadow-md');
                complianceTab.classList.remove('bg-gray-100', 'text-gray-700', 'hover:bg-gray-100');
                myTasksTab.classList.remove('bg-indigo-600', 'text-white', 'shadow-md');
                myTasksTab.classList.add('bg-gray-100', 'text-gray-700', 'hover:bg-gray-100');
                myTasksView.classList.add('hidden');
                complianceView.classList.remove('hidden');
            });

            const filterButtons = document.querySelectorAll('.filter-btn');
            filterButtons.forEach(btn => {
                btn.addEventListener('click', (e) => {
                    filterButtons.forEach(b => {
                        b.classList.remove('bg-indigo-600', 'text-white', 'shadow');
                        b.classList.add('bg-gray-100', 'text-gray-700', 'hover:bg-gray-200');
                    });
                    e.target.classList.add('bg-indigo-600', 'text-white', 'shadow');
                    e.target.classList.remove('bg-gray-100', 'text-gray-700', 'hover:bg-gray-200');
                    currentFilter = e.target.dataset.filter;
                    applyFiltersAndSort();
                });
            });

            searchInput.addEventListener('input', applyFiltersAndSort);
            sortSelect.addEventListener('change', applyFiltersAndSort);

            addTaskBtn.addEventListener('click', () => {
                addTaskModal.classList.remove('hidden');
            });
            cancelTaskBtn.addEventListener('click', () => {
                addTaskModal.classList.add('hidden');
                addTaskForm.reset();
            });
            addTaskForm.addEventListener('submit', (e) => {
                e.preventDefault();
                const title = document.getElementById('task-title').value;
                const type = document.getElementById('task-type').value;
                const priority = document.getElementById('task-priority').value;
                const dueDate = document.getElementById('task-due-date').value;
                const link = document.getElementById('task-link').value;

                const newTask = {
                    id: nextTaskId++,
                    title,
                    type,
                    priority,
                    dueDate,
                    link,
                    status: 'Not Started',
                    source: 'user',
                };
                tasks.push(newTask);
                addTaskModal.classList.add('hidden');
                addTaskForm.reset();
                applyFiltersAndSort();
            });

            complianceTabs.forEach(tab => {
                tab.addEventListener('click', (e) => {
                    complianceTabs.forEach(t => {
                        t.classList.remove('border-indigo-600');
                        t.classList.add('hover:border-gray-300');
                    });
                    e.target.classList.add('border-indigo-600');
                    e.target.classList.remove('hover:border-gray-300');
                    
                    complianceContents.forEach(c => c.classList.add('hidden'));
                    document.getElementById(`${e.target.dataset.tab}-content`).classList.remove('hidden');
                });
            });
            
            // Initial render
            applyFiltersAndSort();
        });
    </script>
</body>
</html>
